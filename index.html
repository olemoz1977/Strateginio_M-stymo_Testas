
<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <title>Strateginio mąstymo testas (STQ)</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#121821; --text:#e6edf3; --muted:#9aa7b5;
      --brand:#2f81f7; --ok:#3fb950; --warn:#f85149; --border:#1f2a37;
    }
    body.light {
      --bg:#ffffff; --panel:#f6f8fa; --text:#111827; --muted:#6b7280;
      --brand:#0a66c2; --ok:#157347; --warn:#b02a37; --border:#e5e7eb;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    header{padding:18px 20px;border-bottom:1px solid var(--border);background:var(--panel);position:sticky;top:0;z-index:10}
    h1{margin:0;font-size:24px}
    h2{margin:6px 0 0;font-size:15px;color:var(--muted)}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    button{appearance:none;border:1px solid var(--border);background:var(--panel);color:var(--text);
      padding:8px 12px;border-radius:8px;cursor:pointer;transition:.15s ease; font-weight:600}
    button:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.25)}
    .primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .success{background:var(--ok);border-color:var(--ok);color:#fff}
    .danger{background:var(--warn);border-color:var(--warn);color:#fff}
    .ghost{background:transparent}
    .meta{display:flex;gap:16px;align-items:center;color:var(--muted);font-weight:600;margin-top:8px}
    main{max-width:980px;margin:0 auto;padding:20px}
    .grid{display:grid;grid-template-columns:1fr;gap:18px;margin-top:18px}
    @media(min-width:900px){ .grid{grid-template-columns:1fr 1fr} }
    section.block{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
    section.block h3{margin:0 0 8px}
    .q{margin:10px 0 14px}
    .q-title{font-weight:700}
    .options{margin-top:8px;display:grid;gap:6px}
    .radio{display:flex;gap:10px;align-items:flex-start;background:transparent;border:1px solid var(--border);border-radius:10px;padding:8px}
    .radio input{margin-top:3px}
    .scorecard{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:18px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center}
    .card .num{font-size:22px;font-weight:800}
    .footnote{margin-top:24px;color:var(--muted);font-size:13px}
    .copyright{margin-top:8px;color:var(--muted)}
    .error{color:var(--warn);font-weight:700;margin-top:8px}
    .hidden{display:none}
    
.insight-grid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:900px){ .insight-grid{grid-template-columns:1fr 1fr} }
.insight-card{
  background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px;
}
.insight-card h4{margin:0 0 6px}
.badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700; margin-left:8px}
.badge.low{background:#2d1f1f; color:#fda4a4; border:1px solid #7f1d1d}
.badge.mid{background:#1f2d25; color:#a7f3d0; border:1px solid #14532d}
.badge.high{background:#1f2633; color:#93c5fd; border:1px solid #1d4ed8}
.insight-list{margin:8px 0 0; padding-left:18px}
.insight-list li{margin:4px 0}

    @media print{
      body{background:#fff;color:#000}
      header{position:static;border:none;background:#fff;color:#000}
      .toolbar{display:none}
      section.block{background:#fff;border:1px solid #ccc}
      .radio{border-color:#ccc}
      .scorecard .card{background:#fff;border:1px solid #ccc}
    }
  </style>
</head>
<body>
<header>
  <h1>Strateginio mąstymo testas (STQ)</h1>
  <h2>Instrukcija: Pasirinkite vieną atsakymą, kuris tiksliausiai atspindi Jūsų įprastą veiksmą tokioje situacijoje.</h2>
  <div class="toolbar">
    <button id="submitBtn" class="primary">Pateikti atsakymus</button>
    <button id="saveBtn">Išsaugoti naršyklėje</button>
    <button id="restoreBtn">Atkurti iš naršyklės</button>
    <button id="printBtn">Spausdinti / PDF</button>
    <button id="clearBtn" class="danger">Išvalyti</button>
    <button id="themeBtn" class="ghost">Tema: Tamsi/Šviesi</button>
  </div>
  <div class="meta">
    <div id="progress">Atsakyta: 0/15</div>
    <div id="errorBox" class="error hidden"></div>
  </div>
</header>

<main>
  <div class="grid" id="blocksContainer"></div>

  <h3>Rezultatai</h3>
  <div class="scorecard">
    <div class="card">
      <div>Sisteminis mąstymas</div>
      <div class="num" id="scoreSystemic">0/25</div>
    </div>
    <div class="card">
      <div>Perframinimas</div>
      <div class="num" id="scoreReframing">0/25</div>
    </div>
    <div class="card">
      <div>Refleksija</div>
      <div class="num" id="scoreReflection">0/25</div>
    </div>
    <div class="card">
      <div>Bendras rezultatas</div>
      <div class="num" id="scoreTotal">0/75</div>
    </div>
    
<!-- ŽODINIS VERTINIMAS + PRAKTINĖS REKOMENDACIJOS -->
<section id="insights" style="margin-top:22px;">
  <h3>Žodinis vertinimas</h3>
  <div id="verbalSummary" class="insight-grid"></div>

  <h3 style="margin-top:18px;">Praktinės rekomendacijos (30 dienų)</h3>
  <div id="actionPlan" class="insight-grid"></div>
</section>

  </div>

  <p class="footnote">
    Skaičiavimas: pasirinkimai vertinami 1–5 balais (nuo mažiau iki labiau strateginio elgesio).
    Kiekviena subskalė turi 5 klausimus → maks. 25; bendras maks. 75. Invertavimą galima įjungti prie konkretaus klausimo.
  </p>

  <p class="copyright">© 2025 STQ. Sukurta Oleg Mozochin („GitHub Pages“). Veikia be serverio, duomenys saugomi tik naršyklėje.</p>
</main>

<script>
(function(){
  // Viskas šiame bloke yra izoliuota: jokie globalūs vardai „nelenda“ į išorę.
  document.addEventListener('DOMContentLoaded', init);

  function init(){
    const errorBox = document.getElementById('errorBox');
    const blocksContainer = document.getElementById('blocksContainer');
    const progressEl = document.getElementById('progress');

    const STORAGE_KEY = 'STQ_answers_v3'; // <-- apibrėžta prieš bet kokius kvietimus

    function showError(msg){
      errorBox.textContent = msg;
      errorBox.classList.remove('hidden');
    }
    function clearError(){
      errorBox.classList.add('hidden');
      errorBox.textContent = '';
    }

    const STQ = [
      {
        blockId: "systemic",
        title: "I. Sisteminis mąstymas",
        questions: [
          { id:"q1", text:"Kai sprendžiu skyriaus biudžeto sumažinimo problemą, aš...",
            options:[
              "visą dėmesį sutelkiu į savo skyriaus išlaidų mažinimą",
              "atsižvelgiu į gretimų skyrių prieštaravimus",
              "paklausiu kelių kitų skyrių vadovų nuomonės",
              "naudoju formalią matricą ir vertinu sąsajas tarp funkcijų",
              "analizuoju poveikį visos organizacijos vertės grandinei"
          ]},
          { id:"q2", text:"Susidūrus su klientų praradimu, aš...",
            options:[
              "iš karto kaltinu pardavimų skyrių ir reikalauju greitų rezultatų",
              "peržiūriu paskutinių savaičių pardavimų ataskaitas",
              "stengiuosi atsekti vidines klaidas (IT, procesai)",
              "peržiūriu pardavimų ir kokybės duomenis, ieškau nesutapimų",
              "analizuoju vidinius procesus ir išorines rinkos tendencijas"
          ]},
          { id:"q3", text:"Mano požiūris į ilgalaikes makro tendencijas (AI, reguliavimas) yra...",
            options:[
              "tai aukščiausios vadovybės reikalas – dirbu su šiandiena",
              "perskaitau naujienas, bet jos neturi įtakos sprendimams",
              "kartais diskutuoju su komanda, be nuolatinio proceso",
              "nuolat stebiu ir peržiūriu skyriaus prioritetus kas ketvirtį",
              "inicijuoju scenarijų planavimą, vertinu verslo modelio pokyčius"
          ]},
          { id:"q4", text:"Kai iškyla problemos, viršijančios mano skyriaus kompetenciją, aš...",
            options:[
              "bandau išspręsti tik savo resursais",
              "perduodu atsakomybę kitam skyriui ir nustoju sekti eigą",
              "bendradarbiauju su 1–2 skyriais dėl kompromiso",
              "inicijuoju tarpfunkcinį susitikimą sistemai sukurti",
              "ieškau organizacinės priežasties, kodėl problema kartojasi"
          ]},
          { id:"q5", text:"Planuojant ilgalaikę strategiją, didžiausią dėmesį skiriu...",
            options:[
              "tikslams pagal praėjusių metų rezultatus",
              "išteklių paskirstymui dabartiniams prioritetams",
              "į išsamias artimiausio metų konkurencijos analizes",
              "įvairioms rizikoms ir vid./išorės veiksniams",
              "kritinių prielaidų nustatymui ir „jei prielaidos klaidingos“ planams"
          ]}
        ]
      },
      {
        blockId: "reframing",
        title: "II. Perframinimas",
        questions: [
          { id:"q6", text:"Komandai neįveikiant sudėtingos kliūties, aš...",
            options:[
              "primenu naudoti jau patvirtintas taktikas",
              "paprašau 3–4 naujų, bet panašių planų",
              "inicijuoju diskusiją dėl radikaliai kitokių idėjų",
              "organizuoju dirbtuves iš kito vaidmens perspektyvos",
              "sustabdyčiau veiklą ir perapibrėžčiau problemą 5 būdais"
          ]},
          { id:"q7", text:"Ruošiantis svarbiam sprendimui, aš visada...",
            options:[
              "ieškau įrodymų, patvirtinančių pradinę idėją",
              "ieškau duomenų tarp dviejų akivaizdžių pasirinkimų",
              "prašau komandos rinkti ir patvirtinančius, ir paneigiančius duomenis",
              "ieškau aktyvių oponentų paruošti atsakomąjį pasiūlymą",
              "kuriu nesuderinamus scenarijus (geriausias/blogiausias/netikėtinas)"
          ]},
          { id:"q8", text:"Susidūrus su sudėtingu tikslu, aš...",
            options:[
              "naudoju tik jau išbandytus metodus",
              "remiuosi populiariais standartais (SWOT)",
              "adaptuoju metodus iš kitų industrijų",
              "tikrinu ar tikslas teisingai apibrėžtas ir gal keičiu kryptį",
              "ieškau nekonvencinių, kūrybinių (rizikingų) sprendimų"
          ]},
          { id:"q9", text:"Iškilus netikėtai problemai, aš...",
            options:[
              "taikau standartines procedūras naujai situacijai",
              "ieškau analogų savo patirtyje",
              "dekonstruoju prielaidas ir bandau jas apversti",
              "greitai pasitelkiu išorinius ekspertus",
              "ieškau sprendimų iš visiškai kitų sričių"
          ]},
          { id:"q10", text:"Kai komanda generuoja idėjas, mano vaidmuo yra...",
            options:[
              "atmesti rizikingas idėjas",
              "užtikrinti realizmą ir biudžetą",
              "paskirti „advokato velnio“ vaidmenį",
              "leisti generuoti laisvai ir rinktis akivaizdų variantą",
              "skatinti idėjas, prieštaraujančias dabartinei strategijai"
          ]}
        ]
      },
      {
        blockId: "reflection",
        title: "III. Refleksija",
        questions: [
          { id:"q11", text:"Po didelės sėkmės/nesėkmės, aš...",
            options:[
              "greitai einu prie kito darbo",
              "surengiu trumpą dėkojimo susitikimą",
              "parašau atmintinę pamokoms komandai",
              "organizuoju struktūruotą peržiūrą su prielaidomis",
              "vedu strateginį dienoraštį ir formuluoju principus"
          ]},
          { id:"q12", text:"Aš aktyviai ieškau kritinio grįžtamojo ryšio...",
            options:[
              "tik iš palaikančių asmenų",
              "tik tada, kai prašo",
              "iš tiesioginių pavaldinių ir vadovų",
              "iš platesnio suinteresuotųjų rato (įskaitant nesutinkančius)",
              "iš nepriklausomų patarėjų iš kitų industrijų"
          ]},
          { id:"q13", text:"Kai analizuoju praeities klaidas, pirmiausia ieškau...",
            options:[
              "kas konkrečiai suklydo – atsakomybei užtikrinti",
              "akivaizdžių sistemos trūkumų – greitam pataisymui",
              "pamokų, padedančių išvengti tų pačių klaidų",
              "prielaidų, kuriomis rėmėmės priimdami sprendimus",
              "organizacinių tendencijų ar kultūrinių spragų"
          ]},
          { id:"q14", text:"Mano nuomonė apie strategijos keitimą (perplanavimą) yra...",
            options:[
              "keisti tik pasiekus blogus rezultatus",
              "planą galima keisti tik metų pabaigoje",
              "keitimai rodo silpnumą, laikauosi pirminio",
              "peržiūrėti nuolat, keisti po išsamios analizės",
              "strateginis planavimas – nuolatinė mokymosi funkcija, keisti nedelsiant gavus naujų duomenų"
          ]},
          { id:"q15", text:"Priėmęs sėkmingą sprendimą, aš...",
            options:[
              "tiesiog džiaugiuosi ir imuosi kito projekto",
              "greitai pasidalinu pamoka su kolegomis",
              "analizuoju veiksmus, atvedusius į sėkmę",
              "dokumentuoju sąlygas, kurias reikėtų pakartoti",
              "išvedu metaprincipą ir tikrinu jo universalumą kitose situacijose"
          ]}
        ]
      }
    ];

    const weight = (idx, invert=false) => invert ? (5-idx) : (idx+1);

    // 1) Render
    function render(){
      blocksContainer.innerHTML = '';
      STQ.forEach(block => {
        const sec = document.createElement('section');
        sec.className = 'block'; sec.id = `block-${block.blockId}`;
        const h3 = document.createElement('h3'); h3.textContent = block.title;
        sec.appendChild(h3);

        block.questions.forEach((q, qi) => {
          const qDiv = document.createElement('div'); qDiv.className = 'q';
          const qTitle = document.createElement('div'); qTitle.className='q-title';
          qTitle.textContent = `${qi+1}. ${q.text}`;
          qDiv.appendChild(qTitle);

          const opts = document.createElement('div'); opts.className='options';
          q.options.forEach((opt, oi) => {
            const id = `${q.id}_${oi}`;
            const row = document.createElement('label'); row.className='radio';
            row.innerHTML = `<input type="radio" id="${id}" name="${q.id}" value="${oi}"><span>${opt}</span>`;
            opts.appendChild(row);
          });

          qDiv.appendChild(opts);
          sec.appendChild(qDiv);
        });

        blocksContainer.appendChild(sec);
      });
    }

    // 2) Event delegavimas (vienas listener’is)
    blocksContainer.addEventListener('change', (ev) => {
      const target = ev.target;
      if(target && target.type === 'radio'){
        clearError();
        updateProgress();
        showScores();
      }
    });

    // 3) Helpers
    function getAnswers(){
      const answers = {};
      STQ.forEach(b => b.questions.forEach(q => {
        const selected = document.querySelector(`input[name="${q.id}"]:checked`);
        answers[q.id] = selected ? Number(selected.value) : null;
      }));
      return answers;
    }
    function updateProgress(){
      const a = getAnswers();
      const answered = Object.values(a).filter(v => v !== null).length;
      progressEl.textContent = `Atsakyta: ${answered}/15`;
    }
    function computeScores(){
      const answers = getAnswers();
      let sys=0, refra=0, refl=0;
      STQ[0].questions.forEach(q => { const v = answers[q.id]; if (v!==null) sys   += weight(v, !!q.invert) });
      STQ[1].questions.forEach(q => { const v = answers[q.id]; if (v!==null) refra += weight(v, !!q.invert) });
      STQ[2].questions.forEach(q => { const v = answers[q.id]; if (v!==null) refl  += weight(v, !!q.invert) });
      return {sys, refra, refl, total: sys+refra+refl};
    }

function showScores(){
  try{
    const {sys, refra, refl, total} = computeScores();
    document.getElementById('scoreSystemic').textContent   = `${sys}/25`;
    document.getElementById('scoreReframing').textContent  = `${refra}/25`;
    document.getElementById('scoreReflection').textContent = `${refl}/25`;
    document.getElementById('scoreTotal').textContent      = `${total}/75`;

    // Nauja eilutė: generuojame žodinį vertinimą ir planą
    renderInsights({sys, refra, refl, total});
  }catch(e){
    showError('Skaičiavimas nutrūko: ' + e.message);
  }
}


/* ======= INTERPRETACIJOS ======= */
// Grąžina žodinį vertinimą ir ženkliuką pagal balą
function describeScale(label, score){
  let level, text;
  if(score <= 10){ // Žemas
    level = 'low';
    text = `${label}: žemas lygis. Rekomenduojama sistemingai stiprinti pagrindinius įpročius ir procesus prieš imantis sudėtingų iniciatyvų.`;
  }else if(score <= 18){ // Vidutinis
    level = 'mid';
    text = `${label}: vidutinis lygis. Pagrindai veikia, bet yra „aklųjų zonų“ ir nenuoseklumo sprendimų priėmime.`;
  }else{ // Aukštas
    level = 'high';
    text = `${label}: aukštas lygis. Stiprybę verta institucionalizuoti – dalintis praktika, kurti standartus ir mentoruoti kitus.`;
  }
  return { level, text };
}

// Grąžina 3–6 labai konkrečius veiksmus per 30 dienų
function buildActions(scores){
  // scores: {sys, refra, refl, total}
  const actions = [];

  // Sisteminis mąstymas
  if(scores.sys <= 10){
    actions.push({title:'Sisteminis mąstymas (0–10)', items:[
      'Sukurk 1 puslapio „Vertės grandinės žemėlapį“: nuo kliento poreikio iki gamybos ir logistikos (A3 formato).',
      'Pradėk kassavaitinį „assumption check“: 3 kritinės prielaidos projektui + ką darysi, jei jos klaidingos.',
      'Suderink 2 kryžminių skyrių susitikimus (pvz., Gamyba + Kokybė): 1 bendras problemos savininkas, 1 bendras KPI.'
    ]});
  }else if(scores.sys <= 18){
    actions.push({title:'Sisteminis mąstymas (11–18)', items:[
      'Įdiek „pareto + priežasties“ šabloną: 80/20 defektų → 3 sisteminės priežastys → atsakingi.',
      'Kas ketvirtį atnaujink scenarijus (best/worst/unexpected) ir peržiūrėk skyriaus prioriteto lentą.',
      'Pridėk „risk lane“ prie projektų Kanban: top-5 rizikos, trigeriai, atsakomybės.'
    ]});
  }else{
    actions.push({title:'Sisteminis mąstymas (19–25)', items:[
      'Sukurk „cross-functional playbook“ (PDF/Confluence): vertės grandinė, rolės, KPI, eskalavimo kelias.',
      'Mentoruok 2 meistrus: parodyk, kaip naudoti sistemines matricas sprendimų priėmime.',
      'Inicijuok trimestrinį „systems review“ su vadovybe: kokias prielaidas keisti prieš kitą ketvirtį.'
    ]});
  }

  // Perframinimas
  if(scores.refra <= 10){
    actions.push({title:'Perframinimas (0–10)', items:[
      'Įvesk „advokato velnio“ rolę idėjų sesijose (rotacija): asmuo privalo sugriauti prielaidas.',
      'Pradėk 30 min. „role-flip“ praktiką: „ką darytų konkurentas/klientas?“ prieš sprendimą.',
      'Kiekvienam sunkesniam tikslui suformuluok alternatyvų problemos apibrėžimą (min. 3).'
    ]});
  }else if(scores.refra <= 18){
    actions.push({title:'Perframinimas (11–18)', items:[
      'Naudok 3 scenarijus (best/worst/wild) prieš tvirtinant planą; priskirk signalus ir veiksmus.',
      'Perkelk 1 metodą iš kitos industrijos į savo procesą (pvz., SMED į perstatymus).',
      'Fiksuok „reframe log“: ką pakeitei problemos formuluotėje ir kokį efektą tai turėjo KPI.'
    ]});
  }else{
    actions.push({title:'Perframinimas (19–25)', items:[
      'Vesk 1 val. dirbtuves meistrams apie perframinimą su realiais pavyzdžiais iš pamainos.',
      'Įdiek idėjų generavimo standartą: 30% „anti-strategy“ idėjų per sesiją.',
      'Publikuok „reframe casebook“: 6 geriausi atvejai per ketvirtį (skaidrės + pamokos).'
    ]});
  }

  // Refleksija
  if(scores.refl <= 10){
    actions.push({title:'Refleksija (0–10)', items:[
      'Įvesk AAR (After Action Review) po svarbių įvykių: kas turėjo vykti, kas įvyko, kodėl, ką keisime.',
      'Kiekvienai nesėkmei dokumentuok 3 prielaidas, kurios lėmė sprendimus (ir ar jos buvo klaidingos).',
      'Prašyk kritinio grįžtamojo ryšio iš bent 1 išorinio patarėjo (ne tavo grandinėje).'
    ]});
  }else if(scores.refl <= 18){
    actions.push({title:'Refleksija (11–18)', items:[
      'Vesk savaitinį „learning stand-up“: 10 min. kiekvieno skyriaus pamoka ir „ką darome kitaip“.',
      'Sukurk „principų“ sąrašą (metareguliavimą) ir patikrink jį kitokiose situacijose.',
      'Surink grįžtamąjį ryšį iš platesnio rato (įskaitant nesutinkančius) – kas mėnesį.'
    ]});
  }else{
    actions.push({title:'Refleksija (19–25)', items:[
      'Standardizuok AAR šabloną (Word/Confluence) ir padaryk privalomu N>3 komandų įvykiams.',
      'Mentoruok 2 vadovus: mokyk refleksijos principų ir prielaidų auditą.',
      'Kurk „learning KPI“ (pvz., uždarytų pamokų/įgyvendintų korekcijų % per mėn.).'
    ]});
  }

  return actions;
}

// Atvaizduoja žodinį vertinimą ir planą
function renderInsights(scores){
  const verbal = document.getElementById('verbalSummary');
  const plan   = document.getElementById('actionPlan');

  // Verbal summary – 3 kortelės
  const dSys  = describeScale('Sisteminis mąstymas', scores.sys);
  const dRefa = describeScale('Perframinimas', scores.refra);
  const dRefl = describeScale('Refleksija', scores.refl);

  const cards = [
    {title:'Sisteminis mąstymas', desc:dSys},
    {title:'Perframinimas', desc:dRefa},
    {title:'Refleksija', desc:dRefl},
  ];

  verbal.innerHTML = cards.map(c => `
    <div class="insight-card">
      <h4>${c.title}
        <span class="badge ${c.desc.level}">
          ${c.desc.level==='low'?'Žemas':c.desc.level==='mid'?'Vidutinis':'Aukštas'}
        </span>
      </h4>
      <p>${c.desc.text}</p>
    </div>
  `).join('');

  // Action plan – 3 kortelės su sąrašais
  const actions = buildActions(scores);
  plan.innerHTML = actions.map(a => `
    <div class="insight-card">
      <h4>${a.title}</h4>
      <ul class="insight-list">
        ${a.items.map(i => `<li>${i}</li>`).join('')}
      </ul>
    </div>
  `).join('');
}

    // 4) Storage (saugus apvyniojimas)
    function saveToStorage(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(getAnswers()));
        alert('Atsakymai išsaugoti naršyklėje.');
      }catch(e){
        showError('Nepavyko išsaugoti: ' + e.message);
      }
    }
    function restoreFromStorage(showAlert=true){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){ if(showAlert) alert('Naršyklėje nerasta išsaugotų atsakymų.'); return; }
        const answers = JSON.parse(raw);
        STQ.forEach(b => b.questions.forEach(q => {
          const v = answers[q.id];
          if(v !== null && v !== undefined){
            const input = document.getElementById(`${q.id}_${v}`);
            if(input) input.checked = true;
          }
        }));
        if(showAlert) alert('Atsakymai atkurti iš naršyklės.');
        updateProgress(); showScores();
      }catch(e){
        showError('Atkūrimo klaida: ' + e.message);
      }
    }
    function clearAll(){
      document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
      updateProgress(); showScores();
    }

    // 5) Mygtukai
    document.getElementById('submitBtn').addEventListener('click', () => {
      const answered = Object.values(getAnswers()).filter(v => v !== null).length;
      if(answered < 15){
        alert(`Neatsakyta į ${15-answered} klausimą(-us). Užpildykite visus 15.`);
        return;
      }
      showScores();
      const card = document.getElementById('scoreTotal').parentElement;
      card.style.outline = '2px solid var(--ok)'; setTimeout(() => card.style.outline='none', 1200);
    });
    document.getElementById('saveBtn').addEventListener('click', saveToStorage);
    document.getElementById('restoreBtn').addEventListener('click', () => restoreFromStorage(true));
    document.getElementById('printBtn').addEventListener('click', () => requestAnimationFrame(() => window.print()));
    document.getElementById('clearBtn').addEventListener('click', () => { if(confirm('Išvalyti visus atsakymus?')) clearAll(); });
    document.getElementById('themeBtn').addEventListener('click', () => document.body.classList.toggle('light'));

    // 6) Tema pagal sistemą
    try{
      const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      if(prefersLight){ document.body.classList.add('light'); }
    }catch{}

    // 7) Paleidimas (svarbu: viskas po deklaracijų)
    render();
    restoreFromStorage(false);  // saugu: STORAGE_KEY jau apibrėžtas
    updateProgress();
    showScores();
  }
})();
</script>
</body>
</html>
